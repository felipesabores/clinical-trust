name: Clinical Trust CD (Template)

# This is a template for Continuous Deployment.
# To activate it:
# 1. Rename this file to deploy.yml
# 2. Add the required secrets to your GitHub repository
# 3. Adjust the SSH commands to match your environment

on:
  workflow_run:
    workflows: ["Clinical Trust CI"]
    types:
      - completed
    branches: [ main ]

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      # Example: Trigger Dokploy Webhook
      - name: Trigger Dokploy Deploy
        if: env.DOKPLOY_WEBHOOK_URL != ''
        run: |
          curl -X POST ${{ secrets.DOKPLOY_WEBHOOK_URL }}
        env:
          DOKPLOY_WEBHOOK_URL: ${{ secrets.DOKPLOY_WEBHOOK_URL }}

      # Example: Deploy via SSH
      # - name: Deploy via SSH
      #   uses: appleboy/ssh-action@master
      #   with:
      #     host: ${{ secrets.SERVER_IP }}
      #     username: ${{ secrets.REMOTE_USER }}
      #     key: ${{ secrets.SSH_PRIVATE_KEY }}
      #     script: |
      #       cd /path/to/project
      #       git pull origin main
      #       cd backend && npm install && npx prisma migrate deploy && npm run build && pm2 restart all
      #       cd ../frontend && npm install && npm run build
